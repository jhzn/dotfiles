#!/bin/sh

if [ -n "$SWAY_BIN" ]; then
	swaybin="$SWAY_BIN"
fi
if [ -n "$@" ]; then
	exec "$swaybin" "$@"
fi

#truncate before launch of sway
#>~/sway.log

# Open STDOUT as $LOG_FILE file for write.
exec 1>>~/sway.log
# Redirect STDERR to STDOUT
exec 2>&1

#nice way to separate launches
printf "Launching sway at: "
date --rfc-3339=s

# Run FF in wayland
export MOZ_ENABLE_WAYLAND=1
# Hardwar acceleration
export MOZ_WAYLAND_USE_VAAPI=1
# Touch support, I think
export MOZ_USE_XINPUT2=1
# TODO why?
# export MOZ_DISABLE_RDD_SANDBOX=1
# Fixes opening of links in XWayland apps?
# TODO verify
export MOZ_DBUS_REMOTE=1

export XDG_SESSION_TYPE=wayland
export XDG_CURRENT_DESKTOP=sway

if [ "$HOST" == "johan-laptop" ]; then
	export VDPAU_DRIVER=va_gl
	export LIBVA_DRIVER_NAME=i965
fi
if [ "$HOST" == "johan-desktop" ]; then
	#open source drivers
	export VDPAU_DRIVER=nouveau
	export LIBVA_DRIVER_NAME=nouveau
fi

export QT_QPA_PLATFORM=wayland

exec "$swaybin"

