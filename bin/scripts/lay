#!/bin/bash

only_update="$1"

set -euo pipefail

# DIR="$HOME/.screenlayout" # For bspwm
DIR="$HOME/bin/swaylayout" # For sway

is_sway_active=$(pgrep sway)
if [[ "$is_sway_active" ]]; then
	CHOICE=$(ls "$DIR"  | fzfmenu)
else
	CHOICE=$(ls "$DIR"  | fzf)
fi
[ -z "$CHOICE" ] && echo "You chose nothing... doing nothing" && exit 1

# Useful before sway is launched to get the right layout before starting
if [[ "$only_update" != "-u" ]]; then
	"$DIR/$CHOICE"
	echo "You chose screenlayout: $CHOICE"
else
	echo "Only updating"
fi

# Save layout so that it is started on next login
echo "$DIR/$CHOICE" > "$MONITOR_LAYOUT_FILE"

