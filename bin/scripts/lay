#!/bin/bash

only_update="$1"

set -euo pipefail

# DIR="$HOME/.screenlayout" # For bspwm
DIR="$HOME/bin/swaylayout" # For sway

validate_choice() {
	[ -z "$1" ] && echo "You chose nothing... doing nothing" && exit 1
}

is_sway_active=$(pgrep sway)
if [[ "$is_sway_active" ]]; then
	CHOICE=$(ls "$DIR" | fzfmenu)
	validate_choice "$CHOICE"
	"$DIR/$CHOICE"
	echo "You chose screenlayout: $CHOICE"
else
	# Useful before sway is launched to get the right layout before starting
	CHOICE=$(ls "$DIR"  | fzf)
	validate_choice "$CHOICE"
	echo "Only updating because Sway is not running"
fi

# Save layout so that it is started on next login
echo "$DIR/$CHOICE" > "$MONITOR_LAYOUT_FILE"

